<section class="top-games-section">
  <h2 class="section-title">Top Games</h2>
  <div class="games-list">
    @for (game of games(); track game.id ?? game.name; let idx = $index) {
      <article class="game-card" [attr.data-rank]="idx+1">
        <div class="rank-badge">
          <span class="rank-number">#{{ idx + 1 }}</span>
        </div>
        <div class="game-thumbnail">
          <img [src]="game.thumbnailUrl"
               [alt]='game.name'
               loading="lazy"/>
          <div class="thumbnail-overlay"></div>
        </div>

        <div class="game-info">
          <h3 class="game-title">{{ game.name }}</h3>

          <div class="rating-container">
            <div class="rating-bar">
              <div class="rating-fill" [style.width.%]="game.rating"></div>
            </div>
            <span class="rating-score">{{ game.rating }}/100</span>
          </div>

          <div class="store-links">
            @if (game.storeLinks?.steamLink || game.storeOwnership?.ownedOnSteam) {
              <a [href]="game.storeLinks?.steamLink || getSteamSearchUrl(game.name)" target="_blank" class="store-badge steam" [class.owned]="game.storeOwnership?.ownedOnSteam" [title]="game.storeLinks?.steamLink ? 'View on Steam' : 'Search on Steam'">
                <i class="bi bi-steam"></i>
                @if (game.storeLinks?.steamRating) {
                  <span class="store-rating">{{ game.storeLinks.steamRating | number:'1.0-0' }}%</span>
                }
                @if (game.storeOwnership?.ownedOnSteam) {
                  <span class="owned-badge">✓</span>
                }
              </a>
            }
            @if (game.storeLinks?.gogLink || game.storeOwnership?.ownedOnGog) {
              <a [href]="game.storeLinks?.gogLink || getGogSearchUrl(game.name)" target="_blank" class="store-badge gog" [class.owned]="game.storeOwnership?.ownedOnGog" [title]="game.storeLinks?.gogLink ? 'View on GOG' : 'Search on GOG'">
                <span class="gog-icon">GOG</span>
                @if (game.storeOwnership?.ownedOnGog) {
                  <span class="owned-badge">✓</span>
                }
              </a>
            }
            @if (game.storeLinks?.epicLink || game.storeOwnership?.ownedOnEpic) {
              <a [href]="game.storeLinks?.epicLink || getEpicSearchUrl(game.name)" target="_blank" class="store-badge epic" [class.owned]="game.storeOwnership?.ownedOnEpic" [title]="game.storeLinks?.epicLink ? 'View on Epic Games' : 'Search on Epic Games'">
                <span class="epic-icon">E</span>
                @if (game.storeOwnership?.ownedOnEpic) {
                  <span class="owned-badge">✓</span>
                }
              </a>
            }
            @if (game.storeLinks?.metacriticLink) {
              <a [href]="game.storeLinks.metacriticLink" target="_blank" class="store-badge metacritic" title="View on Metacritic">
                <span class="mc-icon">MC</span>
                @if (game.storeLinks.metacriticScore) {
                  <span class="store-rating">{{ game.storeLinks.metacriticScore }}</span>
                }
              </a>
            }
          </div>

          <div class="game-flags">
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="checkbox" [id]="'top-played-'+game.id" [(ngModel)]="game.markedAsPlayed"
                     (ngModelChange)="onFlagChange(game)">
              <label class="form-check-label" [for]="'top-played-'+game.id">Played</label>
            </div>
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="checkbox" [id]="'top-hide-'+game.id" [(ngModel)]="game.markedAsHidden"
                     (ngModelChange)="onFlagChange(game)">
              <label class="form-check-label" [for]="'top-hide-'+game.id">Hide</label>
            </div>
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="checkbox" [id]="'top-later-'+game.id" [(ngModel)]="game.markedForLater"
                     (ngModelChange)="onFlagChange(game)">
              <label class="form-check-label" [for]="'top-later-'+game.id">For Later</label>
            </div>
          </div>
        </div>
        <div class="hover-overlay">
          <p class="hover-details">Click to view details</p>
        </div>
      </article>
    }
  </div>
</section>
