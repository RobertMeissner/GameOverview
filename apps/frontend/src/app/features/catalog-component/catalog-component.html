<div class="catalog-container">

  <div class="filter-section mb-3">
    <div class="filter-row">
      <span class="filter-label me-3">Show games with:</span>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="checkbox" id="filter-played"
               [ngModel]="filterPlayed()" (ngModelChange)="filterPlayed.set($event)">
        <label class="form-check-label" for="filter-played">Played</label>
      </div>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="checkbox" id="filter-hidden"
               [ngModel]="filterHidden()" (ngModelChange)="filterHidden.set($event)">
        <label class="form-check-label" for="filter-hidden">Hidden</label>
      </div>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="checkbox" id="filter-forlater"
               [ngModel]="filterForLater()" (ngModelChange)="filterForLater.set($event)">
        <label class="form-check-label" for="filter-forlater">For Later</label>
      </div>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="checkbox" id="filter-unflagged"
               [ngModel]="filterUnflagged()" (ngModelChange)="filterUnflagged.set($event)">
        <label class="form-check-label" for="filter-unflagged">No flags</label>
      </div>
    </div>

    <div class="sort-row">
      <span class="filter-label me-3">Sort by:</span>
      <div class="sort-buttons">
        <button type="button"
                class="sort-btn"
                [class.active]="sortField() === 'rating'"
                (click)="setSortField('rating')">
          <i class="bi" [class.bi-sort-down]="sortField() === 'rating' && sortDirection() === 'desc'"
                        [class.bi-sort-up]="sortField() === 'rating' && sortDirection() === 'asc'"
                        [class.bi-trophy]="sortField() !== 'rating'"></i>
          Rating
        </button>
        <button type="button"
                class="sort-btn"
                [class.active]="sortField() === 'name'"
                (click)="setSortField('name')">
          <i class="bi" [class.bi-sort-alpha-down]="sortField() === 'name' && sortDirection() === 'desc'"
                        [class.bi-sort-alpha-up]="sortField() === 'name' && sortDirection() === 'asc'"
                        [class.bi-fonts]="sortField() !== 'name'"></i>
          Name
        </button>
      </div>
      <div class="export-buttons ms-auto">
        <button type="button"
                class="sort-btn"
                (click)="exportToMarkdown()">
          <i class="bi bi-markdown"></i>
          Export
        </button>
      </div>
    </div>
  </div>

  <div class="game-grid">
    @for (game of filteredGames(); track game.id ?? game.name) {
      <div class="game-card">
        <div class="game-thumbnail">
          <img [src]="game.thumbnailUrl"
               [alt]="game.name"
               loading="lazy"/>
        </div>
        <div class="game-info">
          <h3 class="game-title">{{ game.name }}</h3>
          <div class="rating-container">
            <div class="rating-bar">
              <div class="rating-fill" [style.width.%]="game.rating"></div>
            </div>
            <span class="rating-score">{{ game.rating }}/100</span>
          </div>
          <div class="store-links">
            @if (game.storeLinks?.steamLink || game.storeOwnership?.ownedOnSteam) {
              @if (game.storeLinks?.steamLink) {
                <a [href]="game.storeLinks.steamLink" target="_blank" rel="noopener" class="store-link steam" [class.owned]="game.storeOwnership?.ownedOnSteam" title="View on Steam">
                  <i class="bi bi-steam"></i>
                  @if (game.storeOwnership?.ownedOnSteam) {
                    <span class="owned-badge">✓</span>
                  }
                </a>
              } @else {
                <span class="store-link steam owned" title="Owned on Steam">
                  <i class="bi bi-steam"></i>
                  <span class="owned-badge">✓</span>
                </span>
              }
            }
            @if (game.storeLinks?.gogLink || game.storeOwnership?.ownedOnGog) {
              @if (game.storeLinks?.gogLink) {
                <a [href]="game.storeLinks.gogLink" target="_blank" rel="noopener" class="store-link gog" [class.owned]="game.storeOwnership?.ownedOnGog" title="View on GOG">
                  <span class="gog-icon">GOG</span>
                  @if (game.storeOwnership?.ownedOnGog) {
                    <span class="owned-badge">✓</span>
                  }
                </a>
              } @else {
                <span class="store-link gog owned" title="Owned on GOG">
                  <span class="gog-icon">GOG</span>
                  <span class="owned-badge">✓</span>
                </span>
              }
            }
            @if (game.storeLinks?.epicLink || game.storeOwnership?.ownedOnEpic) {
              @if (game.storeLinks?.epicLink) {
                <a [href]="game.storeLinks.epicLink" target="_blank" rel="noopener" class="store-link epic" [class.owned]="game.storeOwnership?.ownedOnEpic" title="View on Epic Games">
                  <span class="epic-icon">E</span>
                  @if (game.storeOwnership?.ownedOnEpic) {
                    <span class="owned-badge">✓</span>
                  }
                </a>
              } @else {
                <span class="store-link epic owned" title="Owned on Epic Games">
                  <span class="epic-icon">E</span>
                  <span class="owned-badge">✓</span>
                </span>
              }
            }
            @if (game.storeLinks?.metacriticLink) {
              <a [href]="game.storeLinks.metacriticLink" target="_blank" rel="noopener" class="store-link metacritic" title="View on Metacritic">
                <span class="mc-icon">MC</span>
              </a>
            }
          </div>
          <div class="game-flags">
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="checkbox" [id]="'played-'+game.id" [(ngModel)]="game.markedAsPlayed"
                     (ngModelChange)="onFlagChange(game)">
              <label class="form-check-label" [for]="'played-'+game.id">Played</label>
            </div>
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="checkbox" [id]="'hide-'+game.id" [(ngModel)]="game.markedAsHidden"
                     (ngModelChange)="onFlagChange(game)">
              <label class="form-check-label" [for]="'hide-'+game.id">Hide</label>
            </div>
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="checkbox" [id]="'later-'+game.id" [(ngModel)]="game.markedForLater"
                     (ngModelChange)="onFlagChange(game)">
              <label class="form-check-label" [for]="'later-'+game.id">For Later</label>
            </div>
          </div>
        </div>
      </div>
    }
  </div>
</div>
